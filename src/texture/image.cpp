/*
 * image.cpp
 *
 *  Created on: 2016年8月25日
 *      Author: zhuqian
 */
#include <rgb.h>
#include "image.h"
#include "imageio.h"
#include "mipmap.h"
SimpleImageTexture::SimpleImageTexture(TextureMapping2D *m,
		const string& filename,bool doTri,
        Float maxAniso,ImageWrap wm, Float scale, Float gamma) {
	mMapping=m;
	std::vector<unsigned char> image;
	int width;
	int height;
	RGB* data=ReadImage(filename,&width,&height);
	mMipmap = new MIPMap<RGB>(width, height,data, doTri,maxAniso, wm);
}

RGB SimpleImageTexture::Evaluate(const DifferentialGeometry& dg) const{
	 Float s, t, dsdx, dtdx, dsdy, dtdy;
	 mMapping->Map(dg, &s, &t, &dsdx, &dtdx, &dsdy, &dtdy);
	 RGB mem = mMipmap->Lookup(s, t, dsdx, dtdx, dsdy, dtdy);
	 return mem;
}

